<!DOCTYPE html>
<html lang="en">

<head>
    <title>OpenSpendingReview</title>
    
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">

    <!-- JQuery -->
    <script src="http://code.jquery.com/jquery-1.8.2.js"></script>
    <script src="http://code.jquery.com/ui/1.9.1/jquery-ui.js"></script>
    <link href="http://code.jquery.com/ui/1.9.1/themes/base/jquery-ui.css" type="text/css" rel="stylesheet">

    <!-- Bootstrap -->
    <link href="./js/bootstrap/css/bootstrap.min.css" type="text/css" rel="stylesheet">
    <link href="./js/bootstrap/css/bootstrap-responsive.css" type="text/css" rel="stylesheet">
    <script src="./js/bootstrap/js/bootstrap.min.js"></script> 

    <!-- D3.js -->
    <script src="http://d3js.org/d3.v2.js"></script>
    
    <!-- SelectToUISlider -->
    <link href="js/selectToUISlider/css/redmond/jquery-ui-1.7.1.custom.css" type="text/css" rel="stylesheet" />
    <script type="text/javascript" src="js/selectToUISlider/js/selectToUISlider.jQuery.js"></script>
    <link rel="Stylesheet" href="js/selectToUISlider/css/ui.slider.extras.css" type="text/css" />
    
    <!-- Uniform.js -->
    <script src="js/uniform.js/jquery.uniform.js" type="text/javascript" charset="utf-8"></script>
    <link rel="stylesheet" href="js/uniform.js/css/uniform.default.css" type="text/css" media="screen">
    
    <!-- jqGrid -->
    <script src="js/jqGrid/js/jquery.jqGrid.min.js" type="text/javascript"></script>
    <link rel="stylesheet" href="js/jqGrid/css/ui.jqgrid.css" type="text/css" media="screen">

    <style>
      body {
        font-family:"Segoe UI","Helvetica Neue",Helvetica,Arial,sans-serif; 
        padding-top: 60px; /* 60px to make the container go all the way to the bottom of the topbar */
      }
    </style>

 </head>
 
<body>

    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
          <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </a>
          <a class="brand" href="#">OpenSpendingReview</a>
          <div class="nav-collapse collapse">
            
            <!-- Navigation Menu -->
            <ul class="nav pull-left">
              <li class="active"><a href="#speseCorrenti">Spese Correnti</a></li>
              <li><a href="#indicatoriFinanziari">Indicatori Finanziari</a></li>
              <li><a href="#Bilanci">Bilanci</a></li>
            </ul>
            
            
              
            <!-- Login -->
            <ul class="nav pull-right">
                <li><a href="/users/sign_up">Sign Up</a></li>
                <li class="divider-vertical"></li>
                <li class="dropdown">
                    <a class="dropdown-toggle" href="#" data-toggle="dropdown">Sign In <strong class="caret"></strong></a>
                    <div class="dropdown-menu" style="padding: 15px; padding-bottom: 0px;">
                        <!-- Login form here -->
                        <form action="[YOUR ACTION]" method="post" accept-charset="UTF-8">
                          <input id="user_username" style="margin-bottom: 15px;" type="text" name="user[username]" size="30" placeholder="Username" />
                          <input id="user_password" style="margin-bottom: 15px;" type="password" name="user[password]" size="30" placeholder="Password" />
                          <input id="user_remember_me" style="float: left; margin-right: 10px;" type="checkbox" name="user[remember_me]" value="1" />
                          <label class="string optional" for="user_remember_me"> Remember me</label>
                          <input class="btn btn-primary" style="clear: left; width: 100%; height: 32px; font-size: 13px;" type="submit" name="commit" value="Sign In" />
                        </form>
                    </div>
                </li>
            </ul>
            
            <!-- Search Box -->
            <!--
            <form class=navbar-search pull-right">
                <input type="text" class="search-query" placeholder="Search">
            </form>
            -->

            </div><!--/.nav-collapse -->
        
        </div>
      </div>
    </div>

    <div class="container">

        <div class="row-fluid">
            <div class="span12 year-selection-container">
                <div class="section-label"><h4>Anno<h4></div>
                <fieldset id="year-selection-slider">
        			<select name="yearSelection" id="yearSelection">
        				<option value="2007">2007</option>
        				<option value="2008">2008</option>
        				<option value="2009" selected="selected">2009</option>
        				<option value="2010">2010</option>
        				<option value="2011">2011</option>
            			<option value="2012">2012</option>
        			</select>
        		</fieldset>
                <!--
                <div id="year-selection-slider"></div>
                -->
            </div>
        </div>
        

        
        <div class="row-fluid">
          
          <div class="span3 filter-container section-label">
                <span class="filter-item-label-title"><h4>Indicatori</h4></span>
                <form>
                    <ul>
                        <li>
                          <label><input type="radio" name="radio" />Pressione finanziaria (m.p.c.)</label>
                          <label><input type="radio" name="radio" />Pressione tributaria (m.p.c.)</label>
                          <label><input type="radio" name="radio" />Intervento Erariale (m.p.c.)</label>
                          <label><input type="radio" name="radio" />Intervento Regionale (m.p.c.)</label>
                          <label><input type="radio" name="radio" />Vel.Ris.Ent. Pr. (%) (m.p.c.)</label>
                          <label><input type="radio" name="radio" />Vel.Ges.Sp.Cor. (%) (m.p.c.)</label>
                          <label><input type="radio" name="radio" />Autonomia Finanziaria (%) (m.p.c.)</label>
                          <label><input type="radio" name="radio" />Autonomia Impositiva (%) (m.p.c.)</label>
                        </li>
                    </ul>
                </form>
        </div>
          
          
          
          <div class="span6 viz-container section-label">
              <ul class="nav nav-tabs" id="viz-tab">
                <li><a href="#map" data-toggle="tab">Mappa</a></li>
                <li><a href="#table" data-toggle="tab">Tabella</a></li>
              </ul>
              
              <div class="tab-content">
                  <div class="tab-pane active map-container" id="map"></div>
                  <div class="tab-pane table-container" id="table">
                        <table id="data-table"></table>
                        <table class="table table-striped table-bordered table-hover">
                          <thead>
                            <tr>
                              <th>#</th>
                              <th>First Name</th>
                              <th>Last Name</th>
                              <th>Username</th>
                            </tr>
                          </thead>
                          <tbody>
                            <tr>
                              <td>1</td>
                              <td>Mark</td>
                              <td>Otto</td>
                              <td>@mdo</td>
                            </tr>
                            <tr>
                              <td>2</td>
                              <td>Jacob</td>
                              <td>Thornton</td>
                              <td>@fat</td>
                            </tr>
                            <tr>
                              <td>3</td>
                              <td>Larry</td>
                              <td>the Bird</td>
                              <td>@twitter</td>
                            </tr>
                          </tbody>
                        </table>
                        <div id="data-table-pager"></div>
                  </div>
               </div>

          </div>
          
          
          <div class="span3 details-container section-label"><h4>Dettagli<h4></div>
        </div>


    </div> <!-- /container -->
    
    <div id="viz-tooltip">
        <div id ="viz-tooltip-container">
            <span class="viz-tooltip-value"></span>
            <div class="nytg-tail"></div>
        </div>
    </div>

</body>

<style>
#viz-tooltip-container {
  position: absolute;
  bottom: 0;
  width: 230px;
  left: -125px;
  font-size: 12px;
  line-height: 16px;
  padding: 10px;
  border-radius: 3px;
  background: rgba(255,255,255,0.9);
  color: #000;
  box-shadow: 0 1px 5px rgba(0,0,0,0.4);
  -moz-box-shadow: 0 1px 5px rgba(0,0,0,0.4);  
  border:1px solid rgba(200,200,200,0.85);
  text-align:center;
}

#viz-tooltip {
 text-align:center;  
  z-index: 1000;
  position: absolute;
  display: none;
}

#viz-tooltip .nytg-tail {
  position: absolute;
  bottom: -8px;
  left: 105px;
  width: 40px;
  height: 8px;
  background: url(img/tail_white.png) 50% 0%;
}
</style>


<script>
/*
jQuery("#data-table").jqGrid({
       url:'data/geo/italia.provincie.semplificato.geojson',
	datatype: "json",
   	colNames:['Inv No','Date', 'Client', 'Amount','Tax','Total','Notes'],
   	colModel:[
   		{name:'id',index:'id', width:55},
   		{name:'invdate',index:'invdate', width:90},
   		{name:'name',index:'name asc, invdate', width:100},
   		{name:'amount',index:'amount', width:80, align:"right"},
   		{name:'tax',index:'tax', width:80, align:"right"},		
   		{name:'total',index:'total', width:80,align:"right"},		
   		{name:'note',index:'note', width:150, sortable:false}		
   	],
   	rowNum:10,
   	rowList:[10,20,30],
   	pager: '#pager2',
   	sortname: 'id',
    viewrecords: true,
    sortorder: "desc",
    caption:"Data Sample"
});
jQuery("#data-table-pager").jqGrid('navGrid','#data-table-pager',{edit:false,add:false,del:false});
*/
</script>

<script>
//Activate the first Viz tab
$(function () {
    $('#viz-tab a:first').tab('show');
 });
</script>


<script type="text/javascript" charset="utf-8">
    //Activate Uniform UI
      $(function(){
        $("input, textarea, button").uniform();
      });
</script>
    
<script type="text/javascript">
    var svg;
    var projection;
    var centered;
    var path;
    var g;
    
    $(document).ready(function(){
        var w = 1000 /2,
            h = 1000 /2;
        
         projection = d3.geo.mercator()
                            .scale(12000)
                            .translate([-380, 1560]);
          
        path = d3.geo.path()
            .projection(projection);

        svg = d3.select(".map-container").append("svg:svg")
            .attr("width", w)
            .attr("height", h)
            .attr("id", 'svg');
            
        svg.append("rect")
            .attr("class", "background")
            .attr("width", "100%")
            .attr("height", "100%")
            .on("click", click);    
                    
        g = svg.append("g")
            .attr("transform", "translate(" + w / 2 + "," + h / 2 + ")")
            .append("g")
            .attr("id", "states");

        //d3.json("data/geo/italia.regioni.geojson", function(collection) {
        d3.json("data/geo/italia.provincie.semplificato.geojson", function(collection) {
                feature = g.selectAll("path")
                    .data(collection.features)
                    .enter().append("path")
                    .attr("d", path)
                    .attr('stroke', function(d) {
                         return "#AFAFAF"; //default color
                    })
                    .attr('stroke-width', 1)
                    .attr('fill', function(d){
                            return colorForItem(d);
                        })
                    .on("mouseover",function(d,i){
                        //tooltip show/hide code
                        var el = d3.select(this)
                        var xpos = event.pageX;// Number(el.attr('cx'))
                        var ypos = event.pageY-10;//(el.attr('cy') - d.radius - 10)
                        d3.select("#viz-tooltip").style('top',ypos+"px").style('left',xpos+"px").style('display','block');
                        d3.select(".viz-tooltip-value").html("Current region over: " + d.id);
                        //console.log(d + " " + i);
                    })
                    .on("mouseout",function(d,i) { 
                        d3.select("#viz-tooltip").style('display','none')
                    })
                    .on("click", click)
                    /*
                    .append("svg:title")
                    .text(function(d){
                        return "d.name TODO!!";    
                    })
                    */
                    ;
                    
        });
        

    });
    

    function colorForItem(item){
        var random = randomInt(0,100);
        return d3.interpolateRgb("#F1EEF6", "#034E7B")(random/100);
    }
    
    //Return a random number between min and max
    function randomInt(min, max){
        return Math.floor((Math.random()*max)+1)+min;
    }
    
    function updateViz(){
        feature = svg.selectAll("path")
            .transition()
            .attr('fill', function(d){
                    return colorForItem(d);
                });
    }
    
    function click(d) {
      var x = 0,
          y = 0,
          k = 1;
    
      if (d && centered !== d) {
        var centroid = path.centroid(d);
        x = -centroid[0];
        y = -centroid[1];
        k = 4;
        centered = d;
      } else {
        centered = null;
      }
    
      g.selectAll("path")
          .classed("active", centered && function(d) { return d === centered; });
    
      g.transition()
          .duration(1000)
          .attr("transform", "scale(" + k + ")translate(" + x + "," + y + ")")
          .style("stroke-width", 1.5 / k + "px");
    
       g.selectAll("path")
            .filter(function(c){
                return (c != d); //!c.active;
            })
            .transition()
            .duration(500)
             .ease(Math.sqrt)
            .style("opacity",".2");

       g.selectAll("path")
            .filter(function(c){
                return (c === d); //!c.active;
            })
            .transition()
            .duration(500)
             .ease(Math.sqrt)
            .style("opacity","1");

        if (!centered){
           g.selectAll("path")
                .transition()
                .duration(500)
                 .ease(Math.sqrt)
                .style("opacity","1");
        }
        
        console.log("clicked!");
    }

    
    window.onresize = function(event) {
      svg.attr("width", window.innerWidth-45);
      svg.attr("height", window.innerHeight-45);
    }

    
</script>

<script type="text/javascript">
    $(function(){
		var abc = $('select#yearSelection').selectToUISlider().next();
    });
</script>        

<style type="text/css">

    p { 
        clear:both; 
    }
    
    div.year-selection-container {
        margin-bottom: 50px;
    }
    
    #year-selection-slider .ui-slider-label {
        font-size: 10px;
    }
    
	#year-selection-slider fieldset { 
        border:0; 
        margin-top: 0;
    }
    
	#year-selection-slider label {
        font-weight: bold; 
        float: left; 
        margin-right: .5em; 
        font-size: 1.1em;
    }
    
	#year-selection-slider .ui-slider {
        clear: both; 
        top: 0em;
    }
    
    #year-selection-slider select {
        visibility: hidden;
    }
    
    .background {
      fill: none;
      pointer-events: all;
    }
    
    .filter-container ul {
        list-style: none;
    }
    
    .filter-container label {
        font-size: 10px;
        font-weight: bold;
    }
    
    /*
    svg {
      border-style:solid;
      border-width:2px;
      border-color: yellow;
    }

    .filter-container {
      border-style:solid;
      border-width:1px;
      border-color: blue;
    }

    .details-container {
      border-style:solid;
      border-width:1px;
      border-color: blue;
    }

    .map-container {
      border-style:solid;
      border-width:1px;
      border-color: blue;
    }
    */
	
</style>      


</html>
